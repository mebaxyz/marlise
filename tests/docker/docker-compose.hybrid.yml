version: '3.8'

services:
  marlise-hybrid-env:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile.hybrid-services
    container_name: marlise-hybrid-environment
    networks:
      - marlise-hybrid-test
    ports:
      - "5555:5555"  # mock mod-host TCP
      - "6000:6000"  # mock modhost-bridge ZMQ  
      - "5718:5718"  # session-manager ZMQ RPC
      - "6718:6718"  # session-manager ZMQ PUB
      - "7718:7718"  # session-manager ZMQ SUB
      - "8080:8080"  # client-interface HTTP
    volumes:
      - marlise-hybrid-logs:/var/log/marlise
      - marlise-hybrid-data:/opt/marlise/data
    environment:
      - JACK_AUTOSTART_SERVER=0
      - LV2_PATH=/usr/lib/lv2:/usr/local/lib/lv2
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

networks:
  marlise-hybrid-test:
    driver: bridge

volumes:
  marlise-hybrid-logs:
  marlise-hybrid-data:

version: '3.8'

services:
  marlise-real-env:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile.real-services-upstream
    container_name: marlise-real-environment
    networks:
      - marlise-real-test
    ports:
      - "5555:5555"  # mod-host TCP
      - "5556:5556"  # mod-host feedback
      - "6000:6000"  # modhost-bridge ZMQ
      - "5718:5718"  # session-manager ZMQ RPC
      - "6718:6718"  # session-manager ZMQ PUB
      - "7718:7718"  # session-manager ZMQ SUB
      - "8080:8080"  # client-interface HTTP
    volumes:
      - marlise-real-logs:/var/log/marlise
      - marlise-real-data:/opt/marlise/data
    environment:
      - JACK_AUTOSTART_SERVER=0
      - LV2_PATH=/usr/lib/lv2:/usr/local/lib/lv2
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

networks:
  marlise-real-test:
    driver: bridge

volumes:
  marlise-real-logs:
  marlise-real-data: